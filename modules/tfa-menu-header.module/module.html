{#
Module: TFA Menu Header - ULTRA COMPLETO
Description: Renders the primary navigation + Optional CTA with advanced style mapping.
#}

{% set style_mode = module.menu_settings.header_style_override %}
{% if style_mode == "default" or !style_mode %}
  {% set style_mode = theme.set_header.header_style %}
{% endif %}

{% set sticky_mode = module.menu_settings.header_sticky_override %}
{# If default, JS will ignore #}

{# Output data attribute for JS to pick up #}
<div class="tfa-header-module tfa-menu-header-wrapper"
     data-header-style="{{ style_mode }}"
     data-header-sticky="{{ sticky_mode }}">

    <div class="tfa-header-menu-container">
        <div class="tfa-navigation">
            {# Standard HubSpot menu #}
            {% menu
            id="{{ module.menu_settings.navigation_menu }}"
            root_key="{{ module.menu_settings.navigation_menu }}"
            %}
        </div>

        {% if module.cta_settings.show_cta %}
        <div class="tfa-header-cta-wrapper">
            <a href="{{ module.cta_settings.cta_link.url.href }}"
               class="tfa-button tfa-button--primary tfa-button--small">
                {{ module.cta_settings.cta_text }}
            </a>
        </div>
        {% endif %}
    </div>
</div>

{# Script to toggle header style classes based on module selection #}
<div class="hs-code-embed">
<script>
    (function () {
        // Safe execution when DOM is ready
        function applyHeaderOverride() {
            var moduleWrapper = document.querySelector('.tfa-menu-header-wrapper');
            if (moduleWrapper) {
                var styleMode = moduleWrapper.getAttribute('data-header-style');
                var stickyMode = moduleWrapper.getAttribute('data-header-sticky');

                // We look for the main header container.
                var mainHeader = moduleWrapper.closest('.header') || document.querySelector('.header');

                if (mainHeader) {
                    
                    // 1. APPLY STYLE OVERRIDE
                    if (styleMode && styleMode !== 'default') {
                        // Remove existing style classes first
                        var allStyles = [
                            'header--glassmorphism',
                            'header--glassmorphism_dark',
                            'header--solid_white',
                            'header--solid_black',
                            'header--transparent_light',
                            'header--transparent_dark',
                            'header--minimal',
                            'header--gradient_industrial'
                        ];
                        // Remove current styles
                        allStyles.forEach(function(cls) {
                            mainHeader.classList.remove(cls);
                        });

                        // Add the specific override class
                        if (styleMode.indexOf('header--') === -1) {
                             mainHeader.classList.add('header--' + styleMode);
                        } else {
                            mainHeader.classList.add(styleMode);
                        }
                    }

                    // 2. APPLY STICKY OVERRIDE
                    if (stickyMode && stickyMode !== 'default') {
                        // We use .header--sticky or .header--static
                        mainHeader.classList.remove('header--sticky', 'header--static');
                        
                        if (stickyMode === 'sticky') {
                            mainHeader.classList.add('header--sticky');
                        } else if (stickyMode === 'static') {
                            mainHeader.classList.add('header--static');
                        }
                    }
                }
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', applyHeaderOverride);
        } else {
            applyHeaderOverride();
        }
        
        // Listen for editor changes (HubSpot specific)
        window.addEventListener('message', function(event) {
             // In editor, DOM might refresh, so re-apply
            if (event.data.type === 'hs-refresh') {
                setTimeout(applyHeaderOverride, 500);
            }
        });
    })();
</script>
</div>

{#
   CRITICAL CSS FIX:
   Ensure the .header element (parent of this module) can receive styling.
   This style block ensures the module doesn't break layout.
#}
<style>
  .tfa-header-menu-container {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 20px;
  }
</style>
